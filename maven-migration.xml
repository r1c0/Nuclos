<project name="maven-migration" basedir="." xmlns:ac="antlib:net.sf.antcontrib">

	<typedef resource="org/tigris/subversion/svnant/svnantlib.xml" />

	<!-- use command line -->
	<svnSetting id="svn.settings" javahl="false" />

	<target name="info">
		<echo message="Java: ${java.version} (${java.vm.version})" level="info" />
		<echo message="OS: ${os.name} (${os.version}, ${os.arch})" level="info" />
		<echo message="Ant: ${ant.version}" />
	</target>

	<target name="clean" depends="info">
		<delete includeemptydirs="true" quiet="true">
			<!-- org.nuclos.common -->
			<fileset dir="${basedir}/nuclos-common/src/main/java/org/nuclos/common"/>
			<fileset dir="${basedir}/nuclos-common/src/main/resources/org/nuclos/common" />

			<!-- org.nuclos.common2 -->
			<fileset dir="${basedir}/nuclos-common/src/main/java/org/nuclos/common2" />
			<fileset dir="${basedir}/nuclos-common/src/main/resources/org/nuclos/common2" />

			<!-- org.nuclos.server (parts for common -->
			<fileset dir="${basedir}/nuclos-common/src/main/java/org/nuclos/server" />

			<!-- org.nuclos.server -->
			<fileset dir="${basedir}/nuclos-server/src/main/java/org/nuclos/server" />
			<fileset dir="${basedir}/nuclos-server/src/main/resources/org/nuclos/server" />
			<fileset dir="${basedir}/nuclos-server/src/main/resources" includes="*.*, META-INF/" />
			<fileset dir="${basedir}/nuclos-server/src/main/resources/resources" includes="*.*" />
			<fileset dir="${basedir}/nuclos-server/src/main/resources/resources/layoutml" />
			<fileset dir="${basedir}/nuclos-server/src/main/resources/resources/reports" />
			<fileset dir="${basedir}/nuclos-server/src/main/resources/resources/data" />
			<fileset dir="${basedir}/nuclos-server/src/main/resources/resources/db" />

			<!-- org.nuclos.client -->
			<fileset dir="${basedir}/nuclos-client/src/main/java/org/nuclos/client" />
			<fileset dir="${basedir}/nuclos-client/src/main/resources/org/nuclos/client" />
			<fileset dir="${basedir}/nuclos-client/src/main/resources/META-INF" />
			<fileset dir="${basedir}/nuclos-client/src/main/resources/icons" />
			<fileset dir="${basedir}/nuclos-client/src/main/resources/*.*" />

			<!-- org.nuclos.client.synthetica -->
			<fileset dir="${basedir}/nuclos-client-synthetica/src/main/java/org/nuclos/client" />

			<!-- war -->
			<fileset dir="${basedir}/nuclos-war/src/main/webapp" />

			<!-- org.nuclos.installer -->
			<fileset dir="${basedir}/nuclos-installer/src/main/java/org/nuclos/installer" />
			<fileset dir="${basedir}/nuclos-installer/src/main/resources/org/nuclos/installer" />
			<fileset dir="${basedir}/nuclos-installer/lib/axislibs" />
			<fileset dir="${basedir}/nuclos-installer/conf/" />

			<!-- org.nuclos.tools -->
			<fileset dir="${basedir}/nuclos-tools/src/main/java/org/nuclos/tools" />
			<fileset dir="${basedir}/nuclos-tools/src/main/resources/org/nuclos/tools" />
		</delete>
	</target>

	<target name="svn.copy" depends="clean">
		<!-- org.nuclos.common -->
		<svn-copy src="${basedir}/src/java/org/nuclos/common" tgt="${basedir}/nuclos-common/src/main/java/org/nuclos/common" incl="**/*.java, **/package.html" excl="**/.svn" />
		<svn-copy src="${basedir}/src/java/org/nuclos/common" tgt="${basedir}/nuclos-common/src/main/resources/org/nuclos/common" excl="**/*.java, **/package.html, **/.svn" />

		<!-- org.nuclos.common2 -->
		<svn-copy src="${basedir}/src/java/org/nuclos/common2" tgt="${basedir}/nuclos-common/src/main/java/org/nuclos/common2" incl="**/*.java, **/package.html" excl="**/.svn" />
		<svn-copy src="${basedir}/src/java/org/nuclos/common2" tgt="${basedir}/nuclos-common/src/main/resources/org/nuclos/common2" excl="**/*.java, **/package.html, **/.svn" />

		<!-- org.nuclos.server (parts for common -->
		<svn-copy src="${basedir}/src/java/org/nuclos/server" tgt="${basedir}/nuclos-common/src/main/java/org/nuclos/server" incl="**/*Exception.java,
			**/*ValueObject.java,
			**/*VO*.java,
			**/*Dependant*Map.java,
			**/*FacadeRemote.java,
			**/*TreeNode.java,
			**/*ByteArrayCarrier.java,
			**/CanonicalAttributeFormat.java,
			**/DependantMasterDataMapForRule.java,
			**/StateLayout.java,
			**/StateModelLayout.java,
			**/TransitionLayout.java,
			**/NoteLayout.java,
			**/ModuleConstants.java,
			**/*Permission.java,
			**/*Permissions.java,
			**/ProxyList.java,
			**/DocumentFileBase.java,
			**/GenericObjectDocumentFile.java,
			**/InstanceConstants.java,
			**/ResourceFile.java,
			**/*ProxyList.java,
			genericobject/searchcondition/Collectable*SearchExpression.java" excl="**/.svn" />

		<!-- org.nuclos.server -->
		<svn-copy src="${basedir}/src/java/org/nuclos/server" tgt="${basedir}/nuclos-server/src/main/java/org/nuclos/server" incl="**/*.java, **/package.html" excl="**/.svn, **/*Exception.java,
			**/*ValueObject.java,
			**/*VO*.java,
			**/*Dependant*Map.java,
			**/*FacadeRemote.java,
			**/*TreeNode.java,
			**/*ByteArrayCarrier.java,
			**/CanonicalAttributeFormat.java,
			**/DependantMasterDataMapForRule.java,
			**/StateLayout.java,
			**/StateModelLayout.java,
			**/TransitionLayout.java,
			**/NoteLayout.java,
			**/ModuleConstants.java,
			**/*Permission.java,
			**/*Permissions.java,
			**/ProxyList.java,
			**/DocumentFileBase.java,
			**/GenericObjectDocumentFile.java,
			**/InstanceConstants.java,
			**/ResourceFile.java,
			**/*ProxyList.java,
			genericobject/searchcondition/Collectable*SearchExpression.java" />
		<svn-copy src="${basedir}/src/java/org/nuclos/server" tgt="${basedir}/nuclos-server/src/main/resources/org/nuclos/server" excl="**/*.java, **/package.html, **/.svn" />
		<svn-copy src="${basedir}/conf/server" tgt="${basedir}/nuclos-server/src/main/resources" excl="**/.svn" />
		<svn-copy src="${basedir}/conf/resources" tgt="${basedir}/nuclos-server/src/main/resources/resources" excl="**/.svn" />
		<svn-copy src="${basedir}/src/layoutml" tgt="${basedir}/nuclos-server/src/main/resources/resources/layoutml" excl="**/.svn" />
		<svn-copy src="${basedir}/src/reports" tgt="${basedir}/nuclos-server/src/main/resources/resources/reports" excl="**/.svn" />

		<!-- org.nuclos.client -->
		<svn-copy src="${basedir}/src/java/org/nuclos/client" tgt="${basedir}/nuclos-client/src/main/java/org/nuclos/client" incl="**/*.java, **/package.html" excl="synthetica/**/*.java, synthetica/**/package.html, **/.svn" />
		<svn-copy src="${basedir}/conf/client" tgt="${basedir}/nuclos-client/src/main/resources" excl="**/.svn" />
		<svn-copy src="${basedir}/src/java/org/nuclos/client" tgt="${basedir}/nuclos-client/src/main/resources/org/nuclos/client" excl="**/*.java, **/package.html, **/.svn" />
		<svn-copy src="${basedir}/conf/icons" tgt="${basedir}/nuclos-client/src/main/resources/icons" excl="**/.svn" />

		<!-- org.nuclos.client.synthetica -->
		<svn-copy src="${basedir}/src/java/org/nuclos/client" tgt="${basedir}/nuclos-client-synthetica/src/main/java/org/nuclos/client" incl="synthetica/**/*.java, synthetica/**/package.html" excl="**/.svn" />

		<!-- war -->
		<svn-copy src="${basedir}/conf/webapp" tgt="${basedir}/nuclos-war/src/main/webapp" excl="**/.svn" />

		<!-- org.nuclos.installer -->
		<svn-copy src="${basedir}/src/java/org/nuclos/installer" tgt="${basedir}/nuclos-installer/src/main/java/org/nuclos/installer" incl="**/*.java, **/package.html" excl="**/.svn" />
		<svn-copy src="${basedir}/src/java/org/nuclos/installer" tgt="${basedir}/nuclos-installer/src/main/resources/org/nuclos/installer" excl="**/*.java, **/package.html, **/.svn" />
		<svn-copy src="${basedir}/lib/axislibs" tgt="${basedir}/nuclos-installer/lib/axislibs" excl="**/.svn" />
		<svn-copy src="${basedir}/conf/installer" tgt="${basedir}/nuclos-installer/conf/" excl="**/.svn" />
		<svn-copy src="${basedir}/conf/3rdparty" tgt="${basedir}/nuclos-installer/conf/3rdparty" excl="**/.svn" />

		<!-- org.nuclos.tools -->
		<svn-copy src="${basedir}/src/java/org/nuclos/tools" tgt="${basedir}/nuclos-tools/src/main/java/org/nuclos/tools" incl="**/*.java, **/package.html" excl="**/.svn" />
		<svn-copy src="${basedir}/src/java/org/nuclos/tools" tgt="${basedir}/nuclos-tools/src/main/resources/org/nuclos/tools" excl="**/*.java, **/package.html, **/.svn" />

	</target>

	<!-- = = = = = = = = = = = = = = = = =
          macrodef: svn.copy
         = = = = = = = = = = = = = = = = = -->
    <macrodef name="svn-copy">
        <attribute name="src" default="" />
    	<attribute name="tgt" default="" />
    	<attribute name="incl" default="**/*" />
    	<attribute name="excl" default="**/.svn" />
        <sequential>
        	<!-- mkdirs -->
        	<ac:for param="file">
				<path>
					<fileset dir="@{src}" includes="@{incl}" excludes="@{excl}" />
				</path>
				<sequential>
					<path id="src.loc" location="@{file}">
					</path>
					<pathconvert property="@{file}.tgt.1" refid="src.loc">
						<map from="@{src}" to="@{tgt}" />
					</pathconvert>

					<!-- create directory -->
					<dirname property="@{file}.tgt.dirname.1" file="${@{file}.tgt.1}" />
					<echo message="mkdirs ${@{file}.tgt.dirname.1}" />
					<mkdir dir="${@{file}.tgt.dirname.1}" />
				</sequential>
			</ac:for>
        	<!-- svn add for directories -->
        	<ac:for param="dir">
				<path>
					<dirset dir="@{tgt}" />
				</path>
				<sequential>
					<echo message="svn add @{dir}" />
					<svn refid="svn.settings">
						<add dir="@{dir}" recurse="false"/>
					</svn>
				</sequential>
			</ac:for>
        	<!-- svn copy for files -->
        	<ac:for param="file">
				<path>
					<fileset dir="@{src}" includes="@{incl}" excludes="@{excl}" />
				</path>
				<sequential>
					<path id="src.loc" location="@{file}">
					</path>
					<pathconvert property="@{file}.tgt" refid="src.loc">
						<map from="@{src}" to="@{tgt}" />
					</pathconvert>

					<!-- svn copy -->
					<echo message="svn copy @{file} ${@{file}.tgt}" />
					<svn refid="svn.settings">
						<copy srcPath="@{file}" destPath="${@{file}.tgt}" />
					</svn>
				</sequential>
			</ac:for>
        </sequential>
    </macrodef>

</project>