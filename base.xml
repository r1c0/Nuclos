<project name="Base Nucleus" basedir=".">

	<property name="base.home.dir" value="../nucleus"/>

	<property file="../build.properties"/>

	<property environment="env"/>

	<!-- default VM args for running the Nucleus client: -->
	<condition property="run.client.vmargs" value="-ea -ms64m -mx192m">
		<not>
			<isset property="run.client.vmargs"/>
		</not>
	</condition>

	<property name="jboss.lib.dir" value="${jboss.home}/lib"/>
	<property name="jboss.client.dir" value="${jboss.home}/client"/>

	<!-- Configuration used on JBoss to run your server. There must be a directory with the same name under "${jboss.home}/server": -->
	<property name="jboss.server.name" value="nucleus"/>
	<property name="jboss.server.dir" value="${jboss.home}/server/${jboss.server.name}"/>
	<property name="jboss.server.deploy.dir" value="${jboss.server.dir}/deploy"/>
	<property name="jboss.server.lib.dir" value="${jboss.server.dir}/lib"/>

	<property name="java.src.version" value="1.6"/>

	<!-- Set this to "true" when you want to deploy nucleus service (MBeans) configuration -->
	<property name="deploy.jboss.server.nucleus.service" value="false"/>

	<!-- common directories: -->
	<property name="common.dir" value="${base.home.dir}"/>
	<property name="common.src.dir" value="${common.dir}/src/java"/>
	<property name="common.build.deploy.dir" value="${common.dir}/build/deploy"/>

	<!-- nucleus subdirectories: -->
	<property name="nucleus.dir" value="${base.home.dir}"/>
	<property name="nucleus.src.dir" value="${nucleus.dir}/src"/>
	<property name="nucleus.src.java.dir" value="${nucleus.src.dir}/java"/>
	<property name="nucleus.conf.dir" value="${nucleus.dir}/conf"/>
	<property name="nucleus.doc.dir" value="${nucleus.dir}/doc"/>
	<property name="nucleus.db.dir" value="${nucleus.dir}/db"/>
	<property name="nucleus.lib.dir" value="${nucleus.dir}/lib"/>
	<property name="nucleus.build.dir" value="${nucleus.dir}/build"/>
	<property name="nucleus.build.classes.dir" value="${nucleus.build.dir}/classes"/>
	<property name="nucleus.build.deploy.dir" value="${nucleus.build.dir}/deploy"/>
	<property name="nucleus.bin.dir" value="${nucleus.dir}/bin"/>
	<property name="nucleus.dist.dir" value="${nucleus.dir}/dist"/>

	<!-- Source directories: -->
	<property name="src.nucleus.dir" value="${nucleus.src.java.dir}/org/nuclos"/>
	<property name="src.nucleus.common.dir" value="${src.nucleus.dir}/common"/>
	<property name="src.nucleus.client.dir" value="${src.nucleus.dir}/client"/>
	<property name="src.nucleus.server.dir" value="${src.nucleus.dir}/server"/>

	<fileset id="nucleus.common.jars" dir="${nucleus.lib.dir}/common" includes="*.jar"/>
	<fileset id="nucleus.client.jars" dir="${nucleus.lib.dir}/client" includes="*.jar"/>
	<fileset id="nucleus.server.jars" dir="${nucleus.lib.dir}/server" includes="*.jar"/>
	<fileset id="nucleus.shared.jars" dir="${nucleus.lib.dir}/shared" includes="*.jar"/>
	<fileset id="jnlp-servlet.jar" dir="${nucleus.lib.dir}/jnlp-servlet" includes="jnlp-servlet-1.6.jar"/>
	<property name="nucleus.xerlin.jar" value="${nucleus.lib.dir}/xerlin/xerlin-1.3-patched.jar"/>
	<fileset id="nucleus.xerlin.dep.jars" dir="${nucleus.lib.dir}/xerlin" includes="deps/*.jar"/>

	<!-- Bibliotheken aus <JBOSS_HOME>/client, die vom Server und vom Client benutzt werden -->
	<path id="nucleus.common.jboss.client.path">
	    <pathelement location="${jboss.client.dir}/jboss-ejb3x.jar"/>
	    <pathelement location="${jboss.client.dir}/jboss-ejb3-client.jar"/>
	    <pathelement location="${jboss.client.dir}/jboss-annotations-ejb3.jar"/>
		<pathelement location="${jboss.client.dir}/jboss-aop-jdk50-client.jar"/>
		<pathelement location="${jboss.client.dir}/jboss-aspect-jdk50-client.jar"/>
		<pathelement location="${jboss.client.dir}/jboss-transaction-client.jar"/>
		<pathelement location="${jboss.client.dir}/jnp-client.jar"/>
		<pathelement location="${jboss.client.dir}/concurrent.jar"/>
		<pathelement location="${jboss.client.dir}/jbossmq-client.jar"/>
	</path>

	<path id="nucleus.server.path">
		<fileset refid="nucleus.common.jars"/>
		<fileset refid="nucleus.shared.jars"/>
		<fileset refid="nucleus.server.jars"/>

		<pathelement location="${nucleus.build.classes.dir}"/>
		<pathelement location="${common.build.deploy.dir}/novabit-common.jar"/>
		<pathelement location="${common.build.deploy.dir}/novabit-common-ejb.jar"/>
		<pathelement location="${nucleus.lib.dir}/client/layer.jar"/>
		<pathelement location="${nucleus.lib.dir}/client/swingx-1.0.jar"/>
		<pathelement location="${jboss.lib.dir}/jboss-system.jar"/>
		<pathelement location="${jboss.lib.dir}/jboss-common.jar"/>
		<pathelement location="${jboss.lib.dir}/jboss-jmx.jar"/>
		<pathelement location="${jboss.server.lib.dir}/jbosssx.jar"/>
		<pathelement location="${jboss.server.lib.dir}/jboss-j2ee.jar"/>
		<pathelement location="${jboss.server.lib.dir}/jboss-common-jdbc-wrapper.jar"/>
		<pathelement location="${jboss.server.lib.dir}/jboss.jar"/>
		<pathelement location="${jboss.server.lib.dir}/mail.jar"/>

		<path refid="nucleus.common.jboss.client.path"/>
	</path>

	<path id="nucleus.client.path">
		<fileset refid="nucleus.common.jars"/>
		<fileset refid="nucleus.shared.jars"/>
		<fileset refid="nucleus.client.jars"/>
		<fileset refid="nucleus.xerlin.dep.jars"/>

		<pathelement location="${nucleus.build.classes.dir}"/>
		<pathelement location="${common.build.deploy.dir}/novabit-common.jar"/>
		<pathelement location="${jboss.client.dir}/jboss-j2ee.jar"/>
		<pathelement location="${jboss.client.dir}/jboss-client.jar"/>
		<pathelement location="${jboss.client.dir}/jboss-common-client.jar"/>
		<pathelement location="${jboss.client.dir}/jboss-system-client.jar"/>
		<pathelement location="${jboss.client.dir}/jbosssx-client.jar"/>
		<pathelement location="${jboss.client.dir}/jboss-remoting.jar"/>
		<pathelement location="${jboss.client.dir}/jboss-serialization.jar"/>
		<pathelement location="${nucleus.build.deploy.dir}/nuclos-xerlin.jar"/>

		<path refid="nucleus.common.jboss.client.path"/>
	</path>

	<path id="nucleus.path">
		<path refid="nucleus.server.path"/>
		<path refid="nucleus.client.path"/>
	</path>

	<path id="client.run.path">
		<pathelement location="${nucleus.build.deploy.dir}/nuclos-client.jar"/>
		<path refid="nucleus.client.path"/>
	</path>

	<path id="cactus.path">
		<pathelement location="${nucleus.lib.dir}/test/cactus-1.7.1.jar"/>
		<pathelement location="${nucleus.lib.dir}/test/cactus-ant-1.7.1.jar"/>
		<pathelement location="${nucleus.lib.dir}/test/commons-httpclient-2.0.2.jar"/>
		<pathelement location="${nucleus.lib.dir}/test/commons-logging-1.1.jar"/>
		<pathelement location="${nucleus.lib.dir}/test/aspectjrt-1.2.1.jar"/>
		<pathelement location="${nucleus.lib.dir}/test/cargo-0.5.jar"/>
		<!-- junit is needed for cactus, but as it seems it must be available for the parent classloader - why? -->
		<pathelement location="${nucleus.lib.dir}/test/junit-3.8.1.jar"/>
		<!--?OLD? <pathelement location="${nucleus.lib.dir}/xercesImpl.jar"/> -->
	</path>


	<taskdef resource="net/sf/antcontrib/antcontrib.properties">
  		<classpath>
    		<pathelement location="${nucleus.lib.dir}/meta/ant-contrib-1.0b3.jar"/>
  		</classpath>
	</taskdef>

	<target name="wrong.jboss" unless="jboss.present">
		<fail>
			Property "jboss.home" is set but it does not seem to point to the right directory. The file "run.jar" must be
			available at ${jboss.home}/bin.
		</fail>
	</target>

	<target name="init.common" depends="check.build.properties">
		<available property="jboss.present" file="${jboss.home}/bin/run.jar"/>
		<antcall target="wrong.jboss"/>
	</target>

	<target name="check.build.properties" depends="check.jboss.home"/>

	<!-- path to the runtime JBoss directory containing the JBoss application server: -->
	<target name="check.jboss.home" unless="jboss.home">
		<fail>
			Property "jboss.home" is not set. Please use the file "build.properties" to set this property.
			It must point to the directory which contains the following directory: "deploy", "conf", "tmp" etc.
		</fail>
	</target>

</project>
